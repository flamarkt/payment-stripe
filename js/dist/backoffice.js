(()=>{var t={n:e=>{var a=e&&e.__esModule?()=>e.default:()=>e;return t.d(a,{a}),a},d:(e,a)=>{for(var r in a)t.o(a,r)&&!t.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:a[r]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e),r:t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}},e={};(()=>{"use strict";t.r(e),t.d(e,{backoffice:()=>v});const a=((flarum.extensions["flamarkt-backoffice"]||{}).backoffice||{}).app;var r=t.n(a);const n=flarum.core.compat["common/extend"],o=((flarum.extensions["flamarkt-core"]||{}).backoffice||{})["components/PaymentList"];var s=t.n(o);const i=flarum.core.compat["common/components/Button"];var l=t.n(i);function c(t,e){return c=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},c(t,e)}const p=flarum.core.compat["common/components/Modal"];var f=t.n(p);const u=((flarum.extensions["flamarkt-core"]||{}).common||{})["components/PriceInput"];var d=t.n(u);const y=((flarum.extensions["flamarkt-core"]||{}).common||{})["components/PriceLabel"];var h=t.n(y);const g=flarum.core.compat["common/utils/ItemList"];var b=t.n(g),k=function(t){var e,a;function n(){for(var e,a=arguments.length,r=new Array(a),n=0;n<a;n++)r[n]=arguments[n];return(e=t.call.apply(t,[this].concat(r))||this).paidWithOtherMethods=void 0,e.amountDue=void 0,e.amount=void 0,e.saving=!1,e}a=t,(e=n).prototype=Object.create(a.prototype),e.prototype.constructor=e,c(e,a);var o=n.prototype;return o.oninit=function(e){t.prototype.oninit.call(this,e);var a=this.attrs.order;this.paidWithOtherMethods=a.paidAmount()-(this.attrs.payment.amount()||0),this.amountDue=a.priceTotal()-this.paidWithOtherMethods,this.amount=this.amountDue},o.className=function(){return"FlamarktStripeCaptureFundsModal"},o.title=function(){return"Capture Funds"},o.content=function(){return m(".Modal-body",this.fields().toArray())},o.fields=function(){var t=this,e=new(b()),a=this.attrs,r=a.order,n=a.payment;return e.add("info",m(".Form-group",[m("dl",[m("dt","Order total"),m("dd",h().component({value:r.priceTotal()}))]),m("dl",[m("dt","Paid with other methods"),m("dd",h().component({value:this.paidWithOtherMethods}))]),m("dl",[m("dt","Amount due"),m("dd",h().component({value:this.amountDue}))]),m("dl",[m("dt","Amount on hold"),m("dd",h().component({value:n.amount()}))])]),20),e.add("amount",m(".Form-group",[m("label","Amount"),m(d(),{value:this.amount,onchange:function(e){t.amount=e},disabled:this.saving})]),10),e.add("submit",m(".Form-group",[l().component({type:"submit",className:"Button Button--primary",loading:this.saving},"Confirm")]),-10),e},o.onsubmit=function(t){var e=this;t.preventDefault(),this.saving=!0,r().request({method:"POST",url:r().forum.attribute("apiUrl")+"/flamarkt/stripe-capture",body:{paymentIntentId:this.attrs.payment.identifier(),amount:this.amount},errorHandler:this.onerror.bind(this)}).then((function(){e.hide(),r().alerts.show({type:"success"},"Funds captured. Refresh page to see.")})).catch((function(t){throw e.saving=!1,m.redraw(),t}))},n}(f()),v={"components/CaptureFundsModal":k};r().initializers.add("flamarkt-payment-stripe",(function(){r().extensionData.for("flamarkt-payment-stripe").registerSetting({type:"text",setting:"flamarkt-payment-stripe.secretKey",label:r().translator.trans("flamarkt-payment-stripe.backoffice.settings.secretKey")}).registerSetting({type:"text",setting:"flamarkt-payment-stripe.publishableKey",label:r().translator.trans("flamarkt-payment-stripe.backoffice.settings.publishableKey")}).registerSetting({type:"switch",setting:"flamarkt-payment-stripe.hostedCheckout",label:r().translator.trans("flamarkt-payment-stripe.backoffice.settings.hostedCheckout"),help:r().translator.trans("flamarkt-payment-stripe.backoffice.settings.hostedCheckoutHelp")}).registerSetting({type:"switch",setting:"flamarkt-payment-stripe.alwaysRedirect",label:r().translator.trans("flamarkt-payment-stripe.backoffice.settings.alwaysRedirect"),help:r().translator.trans("flamarkt-payment-stripe.backoffice.settings.alwaysRedirectHelp")}).registerSetting({type:"switch",setting:"flamarkt-payment-stripe.cardOnly",label:r().translator.trans("flamarkt-payment-stripe.backoffice.settings.cardOnly"),help:r().translator.trans("flamarkt-payment-stripe.backoffice.settings.cardOnlyHelp")}).registerSetting({type:"switch",setting:"flamarkt-payment-stripe.captureLater",label:r().translator.trans("flamarkt-payment-stripe.backoffice.settings.captureLater"),help:r().translator.trans("flamarkt-payment-stripe.backoffice.settings.captureLaterHelp")}).registerSetting({type:"switch",setting:"flamarkt-payment-stripe.forceLocaleAuto",label:r().translator.trans("flamarkt-payment-stripe.backoffice.settings.forceLocaleAuto"),help:r().translator.trans("flamarkt-payment-stripe.backoffice.settings.forceLocaleAutoHelp")}).registerSetting({type:"switch",setting:"flamarkt-payment-stripe.applePayDomainAssociation",label:r().translator.trans("flamarkt-payment-stripe.backoffice.settings.applePayDomainAssociation"),help:r().translator.trans("flamarkt-payment-stripe.backoffice.settings.applePayDomainAssociationHelp")}),(0,n.extend)(s().prototype,"actions",(function(t,e){"stripe-intent-hold"===e.method()&&t.add("stripe-capture",l().component({icon:"fas fa-credit-card",className:"Button",onclick:function(){var t=r().store.all("flamarkt-orders").find((function(t){return(t.payments()||[]).some((function(t){return t===e}))}));t?r().modal.show(k,{order:t,payment:e}):console.error("Could not find order payment belongs to")}},"Capture funds"))}))}))})(),module.exports=e})();
//# sourceMappingURL=backoffice.js.map